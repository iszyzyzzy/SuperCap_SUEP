# GEMINI.md: Project Overview

This document provides a comprehensive overview of the RM2025 Power Control Board project, intended to be used as a context for AI-assisted development.

## Project Overview

This is an embedded C/C++ project for the STM32G474 microcontroller. It serves as the power control board for a robot, likely for the RoboMaster competition. The board manages a supercapacitor, controls DCDC converters, and communicates with a main control board and a referee system.

The core of the application is an interrupt-driven system built around the STM32's HRTIM (High-Resolution Timer) peripheral. A 4kHz timer interrupt triggers a callback function (`tickCallback` in `Core/Src/UserTask.cpp`) that acts as a simple scheduler, executing various tasks at different frequencies.

### Key Features:

*   **Power Management:** Controls the charging and discharging of a supercapacitor.
*   **Communication:** Uses FDCAN to communicate with a main control board.
*   **Control Loops:** Implements peak current mode control for the Buck-Boost converter.
*   **Protection:** Includes over-current, over-voltage, and other safety features.
*   **Wireless Power:** Optional support for wireless power transfer (WPT).

### Architecture:

The project follows a typical structure for STM32 projects generated by STM32CubeMX.

*   `Core/`: Contains the main application source code.
*   `Drivers/`: Contains the STM32 HAL (Hardware Abstraction Layer) and CMSIS (Cortex Microcontroller Software Interface Standard) files.
*   `Makefile`: The main makefile for the project.
*   `SuperCap.mk`: A supplemental makefile with detailed build rules.
*   `RM2025-PowerControlBoard.ioc`: The STM32CubeMX project file.

### Key Files:

*   `Core/Src/main.c`: The main entry point. Initializes peripherals and calls `systemStart()`.
*   `Core/Src/UserTask.cpp`: Contains the main application logic, including the `systemStart`, `init`, `loop`, and `tickCallback` functions.
*   `Core/Inc/PowerManager.hpp` & `Core/Src/PowerManager.cpp`: Encapsulates the power management logic.
*   `Core/Inc/Communication.hpp` & `Core/Src/Communication.cpp`: Handles FDCAN communication.
*   `README.md`: Provides detailed information about the communication protocol and control loop implementation.

## Building and Running

This project uses a `make`-based build system with the `arm-none-eabi-gcc` toolchain.

### Build Commands:

*   **Build:**
    ```bash
    make
    ```
*   **Clean:**
    ```bash
    make clean
    ```
*   **Rebuild:**
    ```bash
    make rebuild
    ```

The build output is placed in the `build/` directory.

### Flashing:

The `Makefile` does not include a target for flashing the device. A standard flashing tool like `st-flash` or `openocd` would be used with the generated `.bin` or `.hex` file.

**Example using `st-flash`:**

```bash
st-flash write build/RM2025-PowerControlBoard.bin 0x8000000
```

## Development Conventions

*   The code is a mix of C and C++.
*   The application logic is primarily implemented in C++.
*   Hardware initialization is handled by STM32CubeMX-generated C code.
*   Real-time tasks are managed in a simple, non-preemptive scheduler within a timer interrupt.
*   The codebase uses header files (`.hpp`) for C++ class definitions and `.cpp` files for implementation.
